<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Data Wrangling in R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Prof. Bisbee" />
    <script src="libs/header-attrs-2.23/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/lexis.css" type="text/css" />
    <link rel="stylesheet" href="css/lexis-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Data Wrangling in <code>R</code>
]
.subtitle[
## Look at the Data!
]
.author[
### Prof. Bisbee
]
.institute[
### Vanderbilt University
]
.date[
### Lecture Date: 2023/09/18
Slides Updated: 2023-09-15
]

---


&lt;style type="text/css"&gt;
.small .remark-code { /*Change made here*/
  font-size: 85% !important;
}
.tiny .remark-code { /*Change made here*/
  font-size: 50% !important;
}
&lt;/style&gt;



# Agenda

1. What is "data wrangling"?

2. Why `R`?

3. `tibbles` (table dataframes)

4. Political + data **science**

  - Michigan exit polls
  
---

# What is "data wrangling"?

&lt;center&gt;&lt;img src="figs/Wrangler.png" width="90%"&gt;&lt;/center&gt;

--

- Preparing data for analysis

--

  - DANGER: Most important but least appreciated step!
  
---

# Danger!

--

- Data wrangling gone bad

--

&lt;center&gt;&lt;img src="figs/Excel.png" width="55%"&gt;&lt;/center&gt;

---

# Danger!

- Data wrangling gone bad

&lt;center&gt;&lt;img src="figs/GeneExcel.png" width="90%"&gt;&lt;/center&gt;

---

# Danger!

- Data wrangling gone bad

&lt;center&gt;&lt;img src="figs/WashPoRR.png" width="90%"&gt;&lt;/center&gt;

---

# Danger!

- How do we avoid these mistakes?

--

- Three principles

--

  1. Replicability
  
--

  2. Understandability
  
--

  3. Robustness
  
--

- The big picture

--

  - Load **raw data** into an `RStudio` script
  
--

  - Wrangle the data within this script
  
--

  - Save a **new version** of the wrangled data with a **.red[different file name]**
  
--

- The point: Someone else should be able to recreate your work from scratch!
  
---

# Why `R`?

--

- Checks all three boxes

--

- But even `R` can be corrupted...

--

- ...with `Save workspace image`

--

- **.red[NEVER `Save workspace image`]**

--

  - If you do, the next time you open `R`, it will load the modified data
  
---

# NEVER SAVE WORKSPACE IMAGE

&lt;center&gt;&lt;img src="figs/SaveEnvironment.png" width="60%"&gt;&lt;/center&gt;


---

# NEVER SAVE WORKSPACE IMAGE

&lt;center&gt;&lt;img src="figs/SaveEnvironment_2.png" width="60%"&gt;&lt;/center&gt;

---

# Why `R`?

- **.green[ALWAYS]** start with an `empty environment`

--

  - How do you know if the environment is empty?

--

&lt;center&gt;&lt;img src="figs/StartScreen.png" width="100%"&gt;&lt;/center&gt;

---

# Why `R`?

- **.green[ALWAYS]** start with an `empty environment`

  - How do you know if the environment is empty?

&lt;center&gt;&lt;img src="figs/StartScreen_2.png" width="100%"&gt;&lt;/center&gt;

---

# Why `R`?

--

- `R` scripts or `RMarkDown` scripts should be: 

--

  1. Single purpose (but definitions can vary)

--

  2. Well-commented (make it easy for anyone to understand)
  
--

  3. Iteratively built (constant bug checking)
  
---

# Let's get started

--

- Set up a new folder for `Lecture_2023_01_30`

--

  - Three subfolders
  
--
  
&lt;center&gt;&lt;img src="figs/folders.png" width="90%"&gt;&lt;/center&gt;

--

- Download [`MI2020_ExitPoll.rds`](https://github.com/jbisbee1/DS1000_F2023/blob/master/Lectures/Topic3_Data_Wrangling/data/MI2020_ExitPoll.rds) to your `data` folder

---

# Pausing for .blue[science]

--

- What are these data?

--

- "Exit poll" data from Michigan in the fall of 2020

--

  - Polls fielded either on or just before an election
  
--

  - Used to understand *why* voters chose a candidate...
  
--

  - ...not to *predict* who will win (voting data is used for that)
  
---

# Michigan

--

- A "swing state" in 2020, following unexpected support for Trump in 2016

--

&lt;center&gt;&lt;img src="figs/MISwing.png" width="80%"&gt;&lt;/center&gt;

---

# Exit Polls

--

- These polls ask voters to check a box in response to a question

--

&lt;center&gt;&lt;img src="figs/ExitPollImage.png" width="90%"&gt;&lt;/center&gt;

---

# Exit Polls

- These polls ask voters to check a box in response to a question

&lt;center&gt;&lt;img src="figs/EPQuex.png" width="75%"&gt;&lt;/center&gt;


---

# Exit Polls

--

- **Predictive**: Use data to *predict* an outcome of interest.

--

  1. How many voters report voting for each candidate?
  2. What predicts support for Trump? For Biden?
  
--

- **Descriptive**: Use data to *describe* an event.

--

  1. How did Trump support vary by: gender? Age? Education?
  2. When did voters make up their minds?
  3. Why did voters support Trump or Biden?
  4. How do Trump and Biden voters vary in their opinions on: Covid? Race relations?
  
---

# Getting Started


- Open `RStudio` and `require(tidyverse)`


```r
require(tidyverse)
```

--

- Load the data


```r
MI_raw &lt;- readRDS('../data/MI2020_ExitPoll.rds')
```

--

- And take a look


```r
MI_raw
```

```
## # A tibble: 1,231 × 63
##       ID WEIGHT LALVOTERID  GROUP   ZIP DISTRICT    Z1    S1
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;       &lt;hvn&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;hvn&gt;
##  1     9  0.405 LALMI62900…     3 49327        2    NA     1
##  2    66  1.81  LALMI24924…     1 48234       14    NA     1
##  3   225  0.860 LALMI54898…     4 48301        9 48322     1
##  4   243  0.199 LALMI50537…     1 48130        7 48130     1
##  5   286  0.177 LALMI68316…     1 49946        1    NA     1
##  6   293  0.492 LALMI40197…     1 48615        4    NA     1
##  7   365  1.37  LALMI41513…     1 48906        4 48813     1
##  8   367  1.15  LALMI59125…     1 49442        2    NA     1
##  9   388  1.50  LALMI66350…     1 48451        5    NA     1
## 10   417  1.30  LALMI35671…     1 48197       12    NA     1
## # ℹ 1,221 more rows
## # ℹ 55 more variables: S2A &lt;hvn_lbl_&gt;, S2B &lt;hvn_lbl_&gt;,
## #   S3 &lt;hvn_lbl_&gt;, S4 &lt;hvn_lbl_&gt;, VERSION &lt;hvn_lbl_&gt;,
## #   PRSMI20 &lt;hvn_lbl_&gt;, SENMI20 &lt;hvn_lbl_&gt;,
## #   TIME16 &lt;hvn_lbl_&gt;, ISSUE20 &lt;hvn_lbl_&gt;,
## #   QLT20 &lt;hvn_lbl_&gt;, TEMPBIDEN &lt;hvn_lbl_&gt;,
## #   TEMPTRUMP &lt;hvn_lbl_&gt;, CONTROLSEN &lt;hvn_lbl_&gt;, …
```

---

# Tabular Data

--

- Remember that we are using tabular data, where rows are observations (i.e., survey respondents) and columns are variables (i.e., vote choice)

--

- What is the **unit of observation** in these data?

--

  - Voters...which voters?
  
--

  - Voters in Michigan...all of them?
  
--

  - No just a random sample of those leaving the ballot box in 2020

---

# The Process: Steps 1-3

- Step 1: **Look** at the data

--

- Step 2: **Wrangle** the data

--

- Step 3: **Analyze** the data

---

# Step 1: Look at the data

- Goals:

--

1. Understand variable "types"

--

  - Most important: continuous versus categorical

--

2. Identify **missingness**: either `NA` or "unit non-response"

--

  - Unit non-response: observations who didn't provide information
  
--

3. Identify **skew** or other phenomena that require wrangling

--

  - Highly skewed data should be logged
  
  - Some variables should be transformed to **rates** or **proportions**

  
---

# Step 1: Look at the data

- Methods:

--

  1. Just look: see the first few rows and the first few columns
  
--

  2. `glimpse()`: see the first few rows for every column
  
--

  3. `summary()`: see the lowest, highest, mean, median, and quartiles, along with missingness (**better for continuous data**)
  
--

  4. `count()`: see the number of observations in each category (**categorical data only**)
  
---

# Step 1: Look at the data


```r
glimpse(MI_raw)
```

```
## Rows: 1,231
## Columns: 63
## $ ID             &lt;dbl&gt; 9, 66, 225, 243, 286, 293, 365, 367…
## $ WEIGHT         &lt;dbl&gt; 0.4045421, 1.8052619, 0.8601966, 0.…
## $ LALVOTERID     &lt;chr&gt; "LALMI6290066", "LALMI2492492", "LA…
## $ GROUP          &lt;hvn_lbl_&gt; 3, 1, 4, 1, 1, 1, 1, 1, 1, 1, …
## $ ZIP            &lt;dbl&gt; 49327, 48234, 48301, 48130, 49946, …
## $ DISTRICT       &lt;dbl&gt; 2, 14, 9, 7, 1, 4, 4, 2, 5, 12, 7, …
## $ Z1             &lt;dbl&gt; NA, NA, 48322, 48130, NA, NA, 48813…
## $ S1             &lt;hvn_lbl_&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ S2A            &lt;hvn_lbl_&gt; 2, 1, 1, 1, 1, 1, 1, 1, 2, 1, …
## $ S2B            &lt;hvn_lbl_&gt; NA, 1, 1, 1, 2, 1, 1, 1, NA, 1…
## $ S3             &lt;hvn_lbl_&gt; 1, NA, NA, NA, NA, NA, NA, NA,…
## $ S4             &lt;hvn_lbl_&gt; 1, NA, NA, NA, NA, NA, NA, NA,…
## $ VERSION        &lt;hvn_lbl_&gt; 1, 2, 2, 1, 1, 2, 2, 2, 1, 1, …
## $ PRSMI20        &lt;hvn_lbl_&gt; 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, …
## $ SENMI20        &lt;hvn_lbl_&gt; 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, …
## $ TIME16         &lt;hvn_lbl_&gt; 5, NA, NA, 5, 5, NA, NA, NA, 5…
## $ ISSUE20        &lt;hvn_lbl_&gt; 5, NA, NA, 9, 1, NA, NA, NA, 4…
## $ QLT20          &lt;hvn_lbl_&gt; 4, NA, NA, 4, 3, NA, NA, NA, 3…
## $ TEMPBIDEN      &lt;hvn_lbl_&gt; 1, NA, NA, 1, 1, NA, NA, NA, 2…
## $ TEMPTRUMP      &lt;hvn_lbl_&gt; 2, NA, NA, 2, 2, NA, NA, NA, 1…
## $ CONTROLSEN     &lt;hvn_lbl_&gt; 9, NA, NA, 1, 1, NA, NA, NA, 2…
## $ FINSIT         &lt;hvn_lbl_&gt; 3, NA, NA, 3, 3, NA, NA, NA, 3…
## $ ECONVCORONA20  &lt;hvn_lbl_&gt; 1, NA, NA, 1, 1, NA, NA, NA, 2…
## $ FAVBIDEN2      &lt;hvn_lbl_&gt; 1, NA, NA, 1, 1, NA, NA, NA, 2…
## $ FAVTRUMP       &lt;hvn_lbl_&gt; 2, NA, NA, 2, 2, NA, NA, NA, 1…
## $ FORCAND        &lt;hvn_lbl_&gt; NA, 1, 1, NA, NA, 1, 2, 1, NA,…
## $ NEWVOTER       &lt;hvn_lbl_&gt; NA, 2, 2, NA, NA, 2, 2, 2, NA,…
## $ NEC            &lt;hvn_lbl_&gt; NA, 4, 4, NA, NA, 4, 4, 4, NA,…
## $ HANDLEECON20   &lt;hvn_lbl_&gt; NA, 1, 1, NA, NA, 1, 1, 1, NA,…
## $ HANDLECORONA20 &lt;hvn_lbl_&gt; NA, 1, 1, NA, NA, 1, 1, 1, NA,…
## $ RACISM20       &lt;hvn_lbl_&gt; NA, 2, 2, NA, NA, 2, 2, 2, NA,…
## $ VOTE2016       &lt;hvn_lbl_&gt; NA, 1, 1, NA, NA, 1, 1, 1, NA,…
## $ COUNTACC       &lt;hvn_lbl_&gt; NA, 2, 2, NA, NA, 1, 2, 1, NA,…
## $ TRUMP4         &lt;hvn_lbl_&gt; NA, 4, 4, NA, NA, 4, 4, 4, NA,…
## $ CONTAINCOVID   &lt;hvn_lbl_&gt; NA, 4, 4, NA, NA, 4, 3, 4, NA,…
## $ COVIDHARDSHIP  &lt;hvn_lbl_&gt; NA, 3, 1, NA, NA, 2, 2, 2, NA,…
## $ AGE10          &lt;hvn_lbl_&gt; 2, 10, 7, 9, 8, 7, 9, 8, 6, 8,…
## $ SEX            &lt;hvn_lbl_&gt; 2, 2, 2, 1, 2, 2, 1, 1, 2, 1, …
## $ EDUC18         &lt;hvn_lbl_&gt; 4, 1, 5, 4, 5, 3, 3, 3, 4, 4, …
## $ QRACEAI        &lt;hvn_lbl_&gt; 1, 2, 1, 1, 1, 1, 1, 1, 1, 2, …
## $ LATINOS        &lt;hvn_lbl_&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, …
## $ PARTYID        &lt;hvn_lbl_&gt; 3, 1, 1, 3, 3, 3, 1, 1, 2, 1, …
## $ PHIL3          &lt;hvn_lbl_&gt; 2, 2, 1, 9, 1, 2, 9, 2, 3, 2, …
## $ INCOME20       &lt;hvn_lbl_&gt; 3, NA, NA, 9, 4, NA, NA, NA, 4…
## $ BRNAGAIN       &lt;hvn_lbl_&gt; NA, 1, 2, NA, NA, 2, 1, 2, NA,…
## $ CHILD12        &lt;hvn_lbl_&gt; NA, 2, 2, NA, NA, 1, 2, 1, NA,…
## $ LGBT           &lt;hvn_lbl_&gt; NA, 2, 2, NA, NA, 2, 2, 2, NA,…
## $ UNIONHH12      &lt;hvn_lbl_&gt; 2, NA, NA, 2, 2, NA, NA, NA, 2…
## $ QN5            &lt;hvn_lbl_&gt; 3, 2, 3, 2, 2, 3, 2, 2, 3, 2, …
## $ QN6A           &lt;hvn_lbl_&gt; NA, NA, 2, 1, NA, NA, 2, NA, N…
## $ QN6B           &lt;hvn_lbl_&gt; 1, 1, NA, NA, 1, 1, NA, 1, 2, …
## $ QN6C           &lt;hvn_lbl_&gt; 4, 0, 0, 0, 2, 1, 0, 2, 1, 1, …
## $ County         &lt;chr&gt; "NEWAYGO", "WAYNE", "OAKLAND", "WAS…
## $ SMPFIPS        &lt;dbl&gt; 26123, 26163, 26125, 26161, 26013, …
## $ TTID           &lt;dbl&gt; 94989, 94079, 94040, 94468, 94564, …
## $ GEOCODE        &lt;dbl&gt; 5, 1, 2, 2, 5, 3, 2, 5, 2, 2, 3, 4,…
## $ a1age5         &lt;dbl&gt; 1, 5, 4, 5, 4, 4, 5, 4, 3, 4, 5, 5,…
## $ A1RACE         &lt;hvn_lbll&gt; 1, 2, 1, 1, 1, 1, 1, 1, 1, 2, …
## $ A1RACE3        &lt;hvn_lbll&gt; 1, 2, 1, 1, 1, 1, 1, 1, 1, 2, …
## $ A1SEX          &lt;hvn_lbll&gt; 2, 2, 2, 1, 2, 2, 1, 1, 2, 1, …
## $ A1EDUC         &lt;hvn_lbll&gt; 2, 1, 2, 2, 2, 1, 1, 1, 2, 2, …
## $ EDUCWHITE      &lt;hvn_lbll&gt; 1, 4, 1, 1, 1, 2, 2, 2, 1, 3, …
## $ VOTEMETHOD     &lt;dbl&gt; 1, 2, 2, 2, 3, 2, 2, 2, 1, 2, 1, 2,…
```

---

# Step 1-1: Variable Types

- **Continuous Variables**

--

  - `dbl`: numeric data stored with great precision. Can be manipulated with mathematical functions.
  
  - `int`: numeric data stored as integers. `R` typically treats `dbl` and `int` as interchangeable.
  
--

- **Categorical Variables**
  
  - `chr`: string data, consisting of letters (and/or numbers). **Cannot** be manipulated with mathematical functions.
  
  - `fct`: string data that is stored with a number. Typically used to define group membership.
  
--

- **Mixtures**
  
  - `lbl`: string data that is stored with a number. Similar to `fct` but less commonly occurring in base `R`.
  
---

# Step 1-2: Missingness

- Two ways to indicate an observation is missing data

--

  1. `NA` code
  
  2. Some bespoke code for "unit non-response" (often `9`, or `99`, or some large value ending in `9` that is dissimilar from the rest of the data)


---

# Step 1-2: Missingness

- To identify `NA`-style missingness, use `summary()`


```r
# summary(MI_raw %&gt;% select(LALVOTERID,SEX,AGE10,PARTYID,LGBT,QLT20))
```

---

# Step 1-2: Missingness

- To identify unit non-response, can use `count()`


```r
MI_raw %&gt;%
  count(PARTYID)
```

```
## # A tibble: 5 × 2
##      PARTYID     n
##   &lt;hvn_lbl_&gt; &lt;int&gt;
## 1          1   425
## 2          2   280
## 3          3   416
## 4          4    94
## 5          9    16
```

--

- The number `9` indicates unit non-response for `PARTYID`

---

# Step 1-2: Missingness

- To identify unit non-response, can use `count()`


```r
MI_raw %&gt;%
  count(AGE10)
```

```
## # A tibble: 11 × 2
##         AGE10     n
##    &lt;hvn_lbl_&gt; &lt;int&gt;
##  1          1    33
##  2          2    28
##  3          3    42
##  4          4    46
##  5          5    78
##  6          6    83
##  7          7   274
##  8          8   143
##  9          9   290
## 10         10   199
## 11         99    15
```

--

- The number `99` indicates unit non-response for `AGE10`


---

# Step 1-2: Missingness

- To identify unit non-response, can use `count()`


```r
MI_raw %&gt;%
  count(LGBT)
```

```
## # A tibble: 4 × 2
##         LGBT     n
##   &lt;hvn_lbl_&gt; &lt;int&gt;
## 1          1    23
## 2          2   570
## 3          9    23
## 4         NA   615
```

--

- The number `9` indicates unit non-response for `LGBT` **AND** this variable also has `NA`


---

# Step 1-2: Missingness

- If the data isn't labelled, can still **look** to identify unit non-response

--

- Re-introducing...`ggplot()`

--

  - Only interested in **single variable**
  
--

- For now, we need two parts:

--

  1. `aes(x = [x-axis variable])`
  
  2. `geom_histogram()` (for continuous) or `geom_bar()` (for categorical)
  
---

# `ggplot()` Intro


```r
MI_raw %&gt;%
  ggplot(aes(x = AGE10)) + 
  geom_bar()
```

```
## Error in `vec_compare()`:
## ! Can't combine `..1` &lt;haven_labelled_spss&gt; and `..2` &lt;double&gt;.
```

---

# `ggplot()` Intro


```r
MI_raw %&gt;%
  ggplot(aes(x = LGBT)) + 
  geom_bar()
```

```
## Error in `vec_compare()`:
## ! Can't combine `..1` &lt;haven_labelled_spss&gt; and `..2` &lt;double&gt;.
```

---

# `ggplot()` Intro


```r
MI_raw %&gt;%
  ggplot(aes(x = PARTYID)) + 
  geom_bar()
```

```
## Error in `vec_compare()`:
## ! Can't combine `..1` &lt;haven_labelled_spss&gt; and `..2` &lt;double&gt;.
```

---

# Step 1-3: Skew &amp; Transformations

- To identify **skew**, we will also need `ggplot()`

--

&lt;img src="Data_Wrangling_slides_files/figure-html/unnamed-chunk-14-1.png" style="display: block; margin: auto;" /&gt;

--

- We will return to this later

---

# Step 2: Wrangle

- Why wrangle data?


```r
MI_raw %&gt;%
  summarise(avgAge = mean(AGE10,na.rm=T))
```

```
## # A tibble: 1 × 1
##       avgAge
##   &lt;hvn_lbl_&gt;
## 1   8.476036
```


---

# Step 2: Wrangle

- We over-estimate the average age category because `R` doesn't realize these are codes!


```r
MI_raw %&gt;%
  count(AGE10)
```

```
## # A tibble: 11 × 2
##         AGE10     n
##    &lt;hvn_lbl_&gt; &lt;int&gt;
##  1          1    33
##  2          2    28
##  3          3    42
##  4          4    46
##  5          5    78
##  6          6    83
##  7          7   274
##  8          8   143
##  9          9   290
## 10         10   199
## 11         99    15
```

---


# Step 2: Wrangle

- We need to convert **codes** for missing data to `NA`

--

- Use `mutate()` and `ifelse()` to replace `99` with `NA`

--

- `mutate()`:

--

  - Either creates a new column
  
  - Or changes an existing column
  
--

- `ifelse()`:

--

  - Does exactly as it says
  
  - `ifelse([LOGIC],[VALUE IF TRUE],[VALUE IF FALSE])`
  
---

# Step 2: Wrangle

- If: `AGE10` is `99` (i.e., the unit non-response code)

--

- Then: give me an `NA` value

--

- Otherwise: give me whatever `AGE10` is

--


```r
MI_raw %&gt;%
  mutate(AGE10_new = ifelse(AGE10 == 99,NA,AGE10)) %&gt;%
  select(AGE10,AGE10_new) %&gt;%
  slice(c(35,1:20)) # Don't need to know slice() yet, ignore
```

```
## Error in `mutate()`:
## ℹ In argument: `AGE10_new = ifelse(AGE10 == 99, NA,
##   AGE10)`.
## Caused by error in `vec_equal()`:
## ! Can't combine `..1` &lt;haven_labelled_spss&gt; and `..2` &lt;double&gt;.
```


---

# Step 2: Wrangle

- The Assignment Operator (`&lt;-`): `R`'s version of "Save As..."

--

- If we don't either:

--

  1. Overwrite the `MI_raw` object...
  
  2. Or create a new object...
  
--

  - `R` will not remember this new `AGE10_new` variable we created

--


```r
MI_raw %&gt;% select(AGE10_new)
```

```
## Error in `select()`:
## ! Can't subset columns that don't exist.
## ✖ Column `AGE10_new` doesn't exist.
```

---

# Step 2: Wrangle

- Thus we need to use the **assignment operator** (`&lt;-`)


```r
MI_final &lt;- MI_raw %&gt;%
  mutate(AGE10_new = ifelse(AGE10 == 99,NA,AGE10))
```

```
## Error in `mutate()`:
## ℹ In argument: `AGE10_new = ifelse(AGE10 == 99, NA,
##   AGE10)`.
## Caused by error in `vec_equal()`:
## ! Can't combine `..1` &lt;haven_labelled_spss&gt; and `..2` &lt;double&gt;.
```

```r
MI_final %&gt;%
  select(AGE10,AGE10_new) %&gt;%
  slice(c(35,1:20)) # Don't need to know slice() yet, ignore
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```


---

# Step 2: Wrangle

- We can now get a more accurate measure of the average age category

--


```r
MI_final %&gt;%
  summarise(avgAge = mean(AGE10_new,na.rm=T))
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

---

# Variable Classes

- **How should we interpret this number?**

--

  - Does this mean that the average age of respondents is 7?
  
--

  - **NO**: we want to keep the definitions!
  
---

# Converting to `chr`

- There is a helpful package called `haven` which will extract these labels as `factors` 

--

- Install it with `install.packages("haven")` but DON'T `require()` it

--

- We can call on useful functions without `require()` by using two `::`

--


```r
haven::as_factor(MI_final$AGE10) %&gt;% head()
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

---

# Step 2: Wrangle

- Goal: Create a new column that converts the value for `AGE10` to a label

--

- To do this, use `mutate()` + the `haven::as_factor()` function + the `as.character()` function

--

  - Step 1: `as_factor()` function (from `haven`) converts to `fct` class
  
  - Step 2: `as.character()` function (from base `R`) converts to `chr` class

--


```r
MI_final &lt;- MI_final %&gt;%
  mutate(AGE10_labs = as.character(haven::as_factor(AGE10)))
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

--

- **NB:** we **overwrite** `MI_final` to **add** the new column `AGE10_labs`

---

# Step 2: Wrangle


```r
MI_final %&gt;%
  ggplot(aes(x = AGE10_labs)) + 
  geom_bar(stat = 'count')
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

---

# Aside on `geom_bar()`

- Default: `stat = "count"` means show total observations in each category

--

- Override: `stat = "identity"` forces to show a specific value set in `aes()`


```r
MI_final %&gt;%
  count(AGE10_labs) %&gt;%
  ggplot(aes(x = AGE10_labs,y = n)) + 
  geom_bar(stat = 'identity')
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```


---

# Step 2: Wrangle

- Say we want the category labels for `PRSMI20`, `QLT20`, and `LGBT`

--


```r
MI_final &lt;- MI_final %&gt;%
  mutate(preschoice = as.character(haven::as_factor(PRSMI20)),
         Qlty = as.character(haven::as_factor(QLT20)),
         LGBT_lab = as.character(haven::as_factor(LGBT)))
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

```r
MI_final %&gt;%
  select(preschoice,Qlty,LGBT_lab)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```



---

# Preparing a new `tibble`

- .blue[Science] guides us toward which variables to focus on


```r
names(MI_final)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

---

# Let's Wrangle!

- We are interested in presidential vote choice (`PRSMI20` or `preschoice`) and the quality of the candidate the respondent likes most (`QLT20` or `Qlty`)

--

- Look at these first


```r
MI_final %&gt;% select(preschoice,Qlty)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```


---

# Let's Wrangle!

- We can get some preliminary descriptive info with `count()`


```r
MI_final %&gt;%
  count(preschoice)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

---

# Let's Wrangle!

- We can get some preliminary descriptive info with `count()` (.blue[science!])


```r
MI_final %&gt;%
  count(preschoice,SEX)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

---

# Choosing the right function

- But `count()` is less useful for continuous variables


```r
MI_final %&gt;%
  count(WEIGHT)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

---

# Choosing the right function

- Use `summary()` instead


```r
MI_final %&gt;%
  select(WEIGHT) %&gt;%
  summary(WEIGHT)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

---

# Let's Wrangle!

- Recall some of the other helpful functions in `tidyverse`


```r
MI_final %&gt;%
  count(preschoice) %&gt;%
  arrange(desc(n))
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```


---

# Let's Wrangle!

- Let's look for missing data


```r
MI_final %&gt;%
  count(Qlty)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```


---

# Let's Wrangle!

- Drop rows where the respondent didn't answer the "quality" question


```r
MI_final %&gt;%
  drop_na(Qlty) %&gt;%
  count(Qlty)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

---

# Let's Wrangle!

- But we still have the `[DON'T READ] Don't know/refused` respondents

--

- Convert "unit non-response" codes to `NA`

--

  - Need to look at them first!


```r
MI_final %&gt;%
  count(Qlty)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

---

# Let's Wrangle!

- Convert "unit non-response" codes to `NA`


```r
MI_final &lt;- MI_final %&gt;%
  mutate(Qlty = ifelse(grepl("DON'T READ",Qlty),NA,Qlty))
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

```r
MI_final %&gt;%
  count(Qlty)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

---

# Let's Wrangle!

- Drop rows where the respondent didn't answer the "quality" question


```r
MI_final %&gt;%
  drop_na(Qlty) %&gt;%
  count(Qlty)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

---

# Let's Wrangle!

- This is equivalent to `filter(!is.na(Qlty))`


```r
MI_final %&gt;%
  filter(!is.na(Qlty)) %&gt;%
  count(Qlty)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

---

# Aside on filtering `NA`

- Make sure to specify which column has the missing data!

--

- Otherwise get "complete cases" (respondents with no missing data)


```r
MI_final %&gt;%
  drop_na() %&gt;%
  count(QLT20)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

--

- Same as


```r
MI_final %&gt;%
  filter(complete.cases(.)) %&gt;%
  count(QLT20)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```


---

# Let's Wrangle!

- Finally, let's subset the data to focus only on the other variables we are interested in



```r
MI_final &lt;- MI_final %&gt;%
  select(SEX,AGE10,PARTYID,
         WEIGHT,QRACEAI,EDUC18,LGBT,
         BRNAGAIN,LATINOS,RACISM20,
         QLT20,Qlty,PRSMI20,preschoice)
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```

--

- This is our **wrangled** data


```r
MI_final
```

```
## Error in eval(expr, envir, enclos): object 'MI_final' not found
```



---

# Finishing up

--

- And now save both the raw data and our prepared data together


```r
save(MI_raw,MI_final,file = '../output/MI_prepped.RData')
```

```
## Error in save(MI_raw, MI_final, file = "../output/MI_prepped.RData"): object 'MI_final' not found
```

--

- An `.RData` file can contain multiple objects

--

- When we load it, we get access to all the objects we've created


```r
rm(MI_raw,MI_final)
```

```
## Warning in rm(MI_raw, MI_final): object 'MI_final' not
## found
```

```r
load('../output/MI_prepped.RData')
```

```
## Warning in readChar(con, 5L, useBytes = TRUE): cannot open
## compressed file '../output/MI_prepped.RData', probable
## reason 'No such file or directory'
```

```
## Error in readChar(con, 5L, useBytes = TRUE): cannot open the connection
```

--

- **NB: different file extensions require different functions!**

--

  - `load` for `.RData` files
  
  - `read_rds` for `.rds` files
  
  - `read_csv` for `.csv` files


---

# Conclusion

--

- What you need to know from today

--

  1. Why `RStudio` + `R` are great for **wrangling**
  
--
  
  2. `mutate()`
    
--

  3. `ifelse()`
  
--

  4. Assignment Operator ("Save As..."): `&lt;-`
  
---

# Quiz &amp; Homework

- Go to Brightspace and take the **5th** quiz

--

  - The password to take the quiz is #### &lt;!-- 2457 --&gt;
  
--

- **Homework:**

--
  
  1. Work through Data_Wrangling_hw.Rmd
  
  2. Problem Set 2 (on Brightspace)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
